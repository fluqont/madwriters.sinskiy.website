---
import '../styles/global.css';
import Header from "../components/Header.astro";
import BaseHead from '../components/BaseHead.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../consts';
import AuthorsNav from '../components/AuthorsNav.astro';
import AuthorsNavMobile from "../components/AuthorsNavMobile.astro"
import { getCollection } from 'astro:content';
import BlogPost from '../components/BlogPost.astro';

const author = Astro.url.pathname.split("/")[1];
const posts = await getCollection("blog");
const filteredPosts = author ? posts.filter((post) => {
  if (!post.data.author) {
    return "zapiski-sumasshedshey" === author
  }
	else {
    return post.data.author === author;
  }
}) : posts
const sortedPosts = filteredPosts.sort((a, b) =>
	a.data.pubDate.valueOf() - b.data.pubDate.valueOf()
);
---
<!doctype html>
<html lang="en">
  <head>
    <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION}/>
  </head>
  <body class="dark background flex flex-col my-8 mx-8 sm:mx-16 xl:mx-[20%] gap-16">
    <Header />
    <div class="flex flex-col xl:flex-row gap-16">
      <AuthorsNav />
      <AuthorsNavMobile />
      <main class="w-full">
        <section class="flex flex-col gap-4">
          <slot />
          <ul class="flex flex-col gap-4">
            {
              sortedPosts.map((post) => (
                <li>
                  <a href={`/${post.data.author}/${post.slug}/`}>
                    <BlogPost {...post.data} displayType="preview">
                      {post.body.slice(1, 150) + "..."}
                    </BlogPost>
                  </a>
                </li>
              ))
            }
          </ul>
          <slot name="after" />
        </section>
      </main>
    </div>
  </body>
</html>