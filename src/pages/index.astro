---
import Tag from '../components/Tag.astro';
import { WEB_TAGS_LIST } from '../consts';
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import BlogPost from '../components/BlogPost.astro';

const author = Astro.url.pathname.split("/")[1];
const posts = await getCollection("blog");
const filteredPosts = author ? posts.filter((post) => {
  return post.data.author === author;
}) : posts
const sortedPosts = filteredPosts.sort((a, b) =>
	a.data.pubDate.valueOf() - b.data.pubDate.valueOf()
);
---
<Layout>
  <ul class="flex gap-2 flex-wrap">
    {
      WEB_TAGS_LIST.map((tag) => (
        <li>
          <a href={`tag/${tag}`}>
            <Tag>{tag}</Tag>
          </a>
        </li>
      ))
    }
  </ul>
  <ul id="posts" slot="posts">
    {
      sortedPosts.map((post) => (
        <li>
          <a href={`/${post.data.author}/${post.slug}/`}>
            <BlogPost {...post.data} displayType="preview">
              {post.body.slice(1, 150) + "..."}
            </BlogPost>
          </a>
        </li>
      ))
    }
  </ul>
</Layout>